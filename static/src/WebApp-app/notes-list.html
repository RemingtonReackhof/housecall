<link rel="import" href="../../bower_components/polymer/polymer.html">
<link rel="import" href="../../bower_components/paper-card/paper-card.html">
<link rel="import" href="../../bower_components/iron-list/iron-list.html">

<link rel="import" href="../../bower_components/iron-a11y-keys-behavior/iron-a11y-keys-behavior.html">
<link rel="import" href="../../bower_components/iron-scroll-target-behavior/iron-scroll-target-behavior.html">
<link rel="import" href="../../bower_components/iron-resizable-behavior/iron-resizable-behavior.html">

<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout-classes.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">

<dom-module id="notes-list">
  <!-- Defines the element's style and local DOM -->
  <template>
    <style>
      :host {
        display: block;
      }

      .note {
        position: relative;
        width: 100%;
        padding-left: 10px;
        margin: 10px;
        background: #FFFFFF;
        border: 2px solid #9B9B9B;
        box-shadow: 1px 3px 4px 0 rgba(0,0,0,0.50);
        border-radius: 8px;
      }

      .vitalsSnapshot {
        position: relative;
        width: 100%;
        padding-left: 10px;
        margin-bottom: 10px;
        background: #FFFFFF;
        border: 2px solid #9B9B9B;
        box-shadow: 1px 3px 4px 0 rgba(0,0,0,0.50);
        border-radius: 8px;
      }

      .vitalsTitle {
        position: relative;
      }

      .instruction {
        /* Rectangle 2: */
        position: relative;
        width: 100%;
        padding-left: 10px;
        margin-bottom: 10px;
        background: #FFB5B5;
        border: 2px solid #9B9B9B;
        box-shadow: 1px 3px 4px 0 rgba(0,0,0,0.50);
        border-radius: 8px;
      }

      .timeContainer {
        float: right;
        width: 20px;
      }

      .time {
        position: relative;
        right: 20px;
      }

      .content {
        position: relative;
        width: 90%;
      }

      :host {
        height: 375px;
        display: flex;
        flex-direction: column-reverse;
      }
      
      iron-list {
       flex: 1 1 auto;
      }

      #ironList #items.iron-list{
        padding: 10px;
        margin: 0;
        position: absolute;
        top: 0;
        will-change: transform;
      }


@media only screen and (-webkit-max-device-pixel-ratio: 1) {
.iron-list-0 {
  will-change: transform;
}

}

.iron-list-0 #items.iron-list {
  ;
        position: relative;
}

.iron-list-0:not([grid]) #items.iron-list  > * {
  width: 100%;
}

.iron-list-0 #items.iron-list  > * {
  box-sizing: border-box;
        
}

    </style>

    <iron-list id = ironList items="{{notesList}}" --iron-list-items-container = "{margin: 10px;}"">

      <template is="dom-if" if="{{item.isNote}}">

        <paper-card class = "note">
          <div class = "timeContainer">
            <p class = "time"> {{item.timeStamp}} </p>
          </div>
          <p class = "content"> {{item.content}} </p>
        </paper-card>

      </template>


      <template is="dom-if" if="{{item.isInstruction}}">

        <paper-card class = "instruction">
          <div class = "timeContainer">
            <p class = "time"> {{item.timeStamp}} </p>
          </div>
          <h4 class = "instructionTitle"> {{item.title}} </h4>
          <p class = "content"> {{item.content}} </p>
        </paper-card>
        
      </template>


      <template is="dom-if" if="{{item.isSnapshot}}">

        <paper-card class = "vitalsSnapshot">
          <div class = "timeContainer">
            <p class = "time"> {{item.timeStamp}} </p>
          </div>
          <h4 class = vitalsTitle> Vitals Snapshot: </h4>
          <p class = "content"> {{item.content}} </p>
        </paper-card>

      </template>

    </iron-list>

  </template>
  <!-- Creates the element's prototype and registers it -->
  <script>
    var last_note_id = 0;

    Polymer({
      is: 'notes-list',

      ready: function() {
        this.last_note_id = 0;
        this.notesList = [
            {
              id: 1, 
              isNote: true, 
              isInstruction: false, 
              isSnapshot: false, 
              title: "", 
              timeStamp: "1:37", 
              content: "Severe swelling on the right side of the chest suggests a pneumotherax caused by blunt impact from the air bag."
            },
            {
              id: 2, 
              isNote: false, 
              isInstruction: false, 
              isSnapshot: true, 
              title: "", 
              timeStamp: "1:40", 
              content: "BP: 145/90, Temp:  96.9, HR: 110 bpm"
            },
            {
              id: 3, 
              isNote: false, 
              isInstruction: true, 
              isSnapshot: false, 
              title: "Intercostal Insertion", 
              timeStamp: "1:52", 
              content: "1.  Clean the area of insertion (the 5th intercostal space slightly anterior to the mid axillary line) with antiseptic solution (iodine)\n 2.  Place sterile drapes around the area.\n 3.  Apply local anesthetic \n 4.  Insert trocar into the lung using the Seldering Technique (described below)\n 5.  Suture the trocar to the skin to prevent it from falling out. \n 6. Apply dressings to the area"
            },
        ];
      },

      addMessage: function(messageType, messageContent, messageTitle) {
        var currId = notesList.length + 1;
        var currDate = new Date();
        var currTime = "" + (currDate.getHours() <= 12 ? currDate.getHours() : currDate.getHours()-12) + ":" 
+ currDate.getMinutes();
        var isNewNote = false;
        var isNewInstruction = false;
        var isNewSnapshot = false

        if (messageType == "note")
        {
          isNewNote = true;
        }
        else if (messageType == "instruction")
        {
          isNewInstruction = true;
        }
        else
        {
          isNewStanpshot = true;
        }

        $.ajax({
          url: '/notes',
          success: function(e){
            last_note_id = e.note_id[0];
            console.log(last_note_id);
          },
          error: function(){alert("We didn't do it!")},
          type: 'POST',
          dataType: 'json',
          contentType: "application/json",
          data: JSON.stringify({'messageTime': currTime.toString(), 'messageContent': messageContent, 'messageTitle': messageTitle, 'isNote': isNewNote.toString(), 'isInstruction': isNewInstruction.toString(), 'isSnapshot':isNewSnapshot.toString()}),
        });

        var newMessage = {
              id: currId, 
              isNote: isNewNote, 
              isInstruction: isNewInstruction, 
              isSnapshot: isNewSnapshot, 
              title: messageTitle, 
              timeStamp: currTime, 
              content: messageContent
            }

        this.push('notesList', newMessage);

      }

    });
  </script>
</dom-module>